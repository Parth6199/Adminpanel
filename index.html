<!DOCTYPE html>
<html lang="en" class="light">
<head>
  <meta charset="UTF-8" />
  <meta name="robots" content="noindex, nofollow" />
  <title>🔧 ATCR Admin Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
  // 🚫 Block access if not logged in
  if (localStorage.getItem("adminLoggedIn") !== "true") {
    window.location.href = "login.html";
  }
</script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: {
              light: '#dbeafe',
              DEFAULT: '#3b82f6',
              dark: '#1e3a8a'
            }
          }
        }
      }
    }
  </script>
<style>
  html.light body {
    background-color: white;
    color: black;
  }
  html.dark body {
    background-color: #111827; /* Tailwind dark background */
    color: white;
  }
</style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-6">
  <div class="max-w-3xl mx-auto bg-white-800 p-6 rounded-xl shadow-lg border border-primary">
    <div class="flex justify-between items-center mb-6">
<div class="flex justify-center mt-4">
  <img src="western-rail-logo.png"
       alt="Western Railway Logo"
       class="w-28" />
</div>
      <h1 class="text-3xl font-bold text-black dark:text-white">🔐 ATCR Admin Panel</h1>
<div class="bg-white dark:bg-gray-800 rounded-xl shadow p-4 my-4">
  <div class="flex items-center justify-between mb-2">
    <h2 class="text-lg font-bold text-blue-800 dark:text-blue-200">📊 Dashboard</h2>
    <select id="dateRange" class="border px-2 py-1 rounded text-sm">
      <option value="daily">Today</option>
      <option value="weekly">This Week</option>
      <option value="monthly">This Month</option>
    </select>
  </div>

  <div class="grid grid-cols-2 sm:grid-cols-5 gap-2 text-center text-xs font-medium">
    <div class="p-2 bg-blue-100 dark:bg-blue-900 rounded">
      <p id="totalCount" class="text-lg font-bold">0</p>
      <p>Total</p>
    </div>
    <div class="p-2 bg-green-100 dark:bg-green-900 rounded">
      <p id="resolvedCount" class="text-lg font-bold">0</p>
      <p>Resolved</p>
    </div>
    <div class="p-2 bg-red-100 dark:bg-red-900 rounded">
      <p id="pendingCount" class="text-lg font-bold">0</p>
      <p>Pending</p>
    </div>
    <div class="p-2 bg-yellow-100 dark:bg-yellow-900 rounded">
      <p id="internetCount" class="text-lg font-bold">0</p>
      <p>Internet</p>
    </div>
    <div class="p-2 bg-purple-100 dark:bg-purple-900 rounded">
      <p id="telephoneCount" class="text-lg font-bold">0</p>
      <p>Telephone</p>
    </div>
  </div>
</div>
<button onclick="logout()" class="fixed top-4 right-4 bg-red-600 text-white px-4 py-2 rounded shadow hover:bg-red-700">
  Logout
</button>
      <button onclick="toggleTheme()" class="px-4 py-1 rounded bg-primary text-white hover:bg-primary-dark">🌓 Theme</button>
    </div>

    <div class="mb-4 text-yellow-400 font-semibold">
      ⚠️ Technician Access Only — Unauthorized users should not update complaints.
    </div>

    <form id="adminForm" class="space-y-4">
      <label class="block">
       <span class="text-sm text-black dark:text-white">Row Number (from Sheet)</span>
        <input type="number" name="RowNumber" required class="w-full p-2 mt-1 border border-gray-600 rounded bg-gray-700 text-white" />
      </label>

      <label class="block">
        <span class="text-sm text-black dark:text-white">👷 Attended By</span>
        <input type="text" name="AttendedBy" required class="w-full p-2 mt-1 border border-gray-600 rounded bg-gray-700 text-white" />
      </label>

      <label class="block">
        <span class="text-sm text-black dark:text-white">✅ Failure Resolved?</span>
        <select name="FailureResolved" required class="w-full p-2 mt-1 border border-gray-600 rounded bg-gray-700 text-white">
          <option value="">-- Select Option --</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
        </select>
      </label>

      <label class="block">
        <span class="text-sm text-black dark:text-white">📝 Remarks</span>
        <textarea name="Remarks" rows="3" class="w-full p-2 mt-1 border border-gray-600 rounded bg-gray-700 text-white"></textarea>
      </label>

      <button type="submit" class="w-full bg-primary text-white py-2 px-4 rounded hover:bg-primary-dark">📤 Update Complaint</button>
    </form>

    <p id="responseMsg" class="mt-4 font-medium text-center text-green-400"></p>
  </div>

  <script>
    function toggleTheme() {
  const html = document.documentElement;
  if (html.classList.contains("light")) {
    html.classList.remove("light");
    html.classList.add("dark");
  } else {
    html.classList.remove("dark");
    html.classList.add("light");
  }
}
  </script>

  <script src="index.js"></script>
<p class="fixed bottom-2 right-4 text-xs italic text-black dark:text-white opacity-70">
  Designed by Parth Parmar
</p>
<script>
  function logout() {
    localStorage.removeItem("adminLoggedIn");
    window.location.href = "login.html";
  }
</script>
<script>
  // Simulated complaintData array — we'll replace this later with fetch
  let complaintData = [];

  function updateDashboard(range = 'daily') {
    const today = new Date();
    let startDate;

    switch (range) {
      case 'weekly':
        startDate = new Date(today);
        startDate.setDate(today.getDate() - 7);
        break;
      case 'monthly':
        startDate = new Date(today.getFullYear(), today.getMonth(), 1);
        break;
      default:
        startDate = new Date(today);
        startDate.setHours(0, 0, 0, 0);
    }

    let total = 0, resolved = 0, pending = 0, internet = 0, telephone = 0;

    complaintData.forEach(row => {
      const date = new Date(row.timestamp);
      if (date >= startDate) {
        total++;
        if (row.status === 'Resolved') resolved++;
        else pending++;

        if (row.type === 'Internet') internet++;
        if (row.type === 'Telephone') telephone++;
      }
    });

    // Update dashboard numbers
    document.getElementById("totalCount").textContent = total;
    document.getElementById("resolvedCount").textContent = resolved;
    document.getElementById("pendingCount").textContent = pending;
    document.getElementById("internetCount").textContent = internet;
    document.getElementById("telephoneCount").textContent = telephone;
  }

  document.getElementById("dateRange").addEventListener("change", (e) => {
    updateDashboard(e.target.value);
  });

  // TEMP sample data for testing
  complaintData = [
    {
      timestamp: '2025-07-10T09:15:00',
      status: 'Resolved',
      type: 'Internet'
    },
    {
      timestamp: '2025-07-11T10:32:00',
      status: 'Pending',
      type: 'Telephone'
    }
  ];

  updateDashboard("daily"); // Show today's data by default
</script>
</body>
</html>